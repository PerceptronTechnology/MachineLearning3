## marimo の概要

> **【注意】** marimo の仕様は、2025/12/7 時点の最新バージョン（0.18.3）に基づいています。

### インストールと設定

ここでは、marimo をプロジェクトという単位で動かす方法について説明します。プロジェクトマネージャとしては uv を使います。プロジェクトは、1つのディレクトリに仮想環境や関連ファイルをまとめて管理する方法で、Git のリポジトリという概念や、コーディングエージェントの作業単位とも、相性のよいものです。

それぞれの OS に応じた方法でプロジェクトディレクトリを作成した後は、VSCode を使う前提で解説します。プロジェクトディレクトリを VSCode で開き、初期設定として、ターミナルで以下のコマンドを実行します。これは、このディレクトリのを uv で管理するプロジェクト（Python 処理系のバージョンは 3.13）として初期化した後、marimo を推奨パッケージとともにインストールしています。

```bash
$ uv init -p 3.13
$ uv add marimo[recommended]
```

推奨パッケージには、データベースアクセスや OpenAI API などが含まれており、ディレクトリのサイズは 479MB 程度になります（Windows OS の場合）。marimo ライブラリが最低限動くように限定して、`uv add marimo` でインストールした場合は、146MB 程度です。いずれもローカルのディスクはかなり消費しますが、.gitignore で `.venv` と `__marimo__`  をリポジトリから除外しておくと、リポジトリは数 MB 程度に収まります。uv を使っている場合は、ライブラリを含めた Python の実行環境は、Pyproject.toml ファイル（人手で記述可能なライブラリの要求仕様）と、uv.lock ファイル（インストールされたライブラリの依存関係を反映した正確なバージョン情報で、人が読むことは想定されていない）で管理され、`uv sync` コマンドで同じ環境を再現できます。

この段階で仮想環境が作成されるので、VSCode で「新しい環境が作成されました。これをワークスペース フォルダーに選択しますか?」というポップアップが表示されたら、「はい」をクリックして、Python インタプリタとして uv の仮想環境を指定します。

uv 環境にインストールされたコマンドは、`uv run コマンド` で実行されるので、以下のコマンドでブラウザに marimo ノートブックが表示されます。

```bash
$ uv run marimo edit my_notebook.py
```

![notebook](../images/notebook.svg)


### ブラウザインタフェース

* セルの操作
  - セルに Python のコードまたはマークダウンテキストを書いて、Shift + Enter キーで実行します。セルが未実行の場合は、セル右上の '▶' ボタンが黄色になっているので、これをクリックしても実行できます。
  - セルの追加は、セル左側上下の '+' で、セルの種類を選んで追加します。ノートブックの最下行への追加は、専用のボタンが表示されています。
  - セルの種類は、Python、マークダウン、SQL、Setup（すべてのセルの実行に先立って実行されるセル）があります。Setup セルは、最下行の追加ボタンでは追加できません。また、Python と SQL は、AI による生成が行えます。
  - セルの削除は、セル右下のゴミ箱アイコンをクリックします。
  - その他のセル操作は、セル右上のメニューボタン '…' をクリックして表示されるメニューから行います。
* 補助的な情報の表示
  - 画面左側のアイコンをクリックすることで、その横にサイドバーが開いて、ファイル構成の表示、変数エクスプローラ、DAG などを表示することができます。 
* アプリ画面の設計
  - 画面右側のボタンから、marimo ノートブックをアプリとして起動したときの画面設計が行えます。スライドやグリッドで設計した場合は、`layouts` ディレクトリに画面構成情報が保存されます。
* 実行ファイルと設定ファイル
  - marimo ノートブックの実行ファイルは、.py 拡張子を持つ Python ファイルです。.py ファイルの編集中は、ほぼリアルタイムに自動保存されますが、手動で保存したい場合は、画面右側のディスクアイコンをクリックします。
  - marimo ノートブックの実行結果は、`__marimo__` ディレクトリに JSON 形式で保存されます。これによって、ノートブックを再度開いたときに前回の情報が表示されます。
  - ブラウザインターフェースを使うときに用いる設定情報は、ユーザのホームディレクトリである `~/.config/marimo/marimo.toml` に保存されます。これによって、異なる仮想環境でも、同じ設定で marimo ノートブックを使うことができます。

ブラウザを使わずに、VSCode 内で作業を完結させたい場合は、VSCode の marimo 拡張機能を使います。VSCode のプロジェクト内で、marimo ライブラリを使っている .py ファイルを開くと、"Open as marimo notebook" というボタンがエディタ画面上部に表示されます。この場合、ブラウザでの作業とはインタフェースが少し異なります

### marimo のコマンド

* `uv run marimo edit <notebook_file>`: 指定したノートブックファイルを開き、ブラウザで編集できるようにします。ノートブックファイルが存在しない場合は、新しいノートブックを作成します。

* `uv run marimo run <notebook_file>`: 指定したノートブックファイルを web アプリとして実行します。コードは隠され、インターフェース部品や、明示的に表示を指示した内容のみが表示されます。

* `uv run marimo convert <ipynb_file> -o <marimo_file>`: Jupyter Notebook 形式の .ipynb ファイルを marimo ノートブック形式の .py ファイルに変換します。

### 参考文献

* インストール手順と簡単な操作は、[奥村先生の解説](https://okumuralab.org/~okumura/python/marimo.html) に簡潔にまとめられています。

* [uv のサイト](https://docs.astral.sh/uv/guides/integration/marimo/)で、marimo との組み合わせ方が説明されています。このページの "Using marimo within a project" のセクションで、プロジェクト単位で marimo を使う方法が解説されています。
